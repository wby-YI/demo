{"remainingRequest":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\src\\views\\acl\\permission\\list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\src\\views\\acl\\permission\\list.vue","mtime":1638345809000},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652600907899},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1652600964560},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652600907899},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1652600973833}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgovLyDoj5zljZXmnYPpmZDmoKHpqoznmoTop4TliJkKY29uc3QgbWVudVJ1bGVzID0geyAKICBuYW1lOiBbe3JlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn5ZCN56ew5b+F6aG76L6T5YWlJ31dLAogIGNvZGU6IFt7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfmnYPpmZDlgLzlv4XpobvovpPlhaUnfV0sCn0KCi8vIOaMiemSruWKn+iDveadg+mZkOagoemqjOeahOinhOWImQpjb25zdCBidG5SdWxlcyA9IHsgCiAgbmFtZTogW3tyZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+WQjeensOW/hemhu+i+k+WFpSd9XSwKICBjb2RlOiBbe3JlcXVpcmVkOiB0cnVlLCB0cmlnZ2VyOiAnYmx1cicsIG1lc3NhZ2U6ICflip/og73mnYPpmZDlgLzlv4XpobvovpPlhaUnfV0KfQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdQZXJtaXNzaW9uTGlzdCcsCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBtZW51UGVybWlzc2lvbkxpc3Q6IFtdLCAvLyDoj5zljZXliJfooagKICAgICAgZXhwYW5kS2V5czogW10sIC8vIOmcgOimgeiHquWKqOWxleW8gOeahOmhuQogICAgICBkaWFsb2dQZXJtaXNzaW9uVmlzaWJsZTogZmFsc2UsIC8vIOaYr+WQpuaYvuekuuiPnOWNleadg+mZkOeahERpYWxvZwogICAgICBwZXJtaXNzaW9uOiB7IC8vIOimgeaTjeS9nOeahOiPnOWNleadg+mZkOWvueixoQogICAgICAgIGxldmVsOiAwLAogICAgICAgIG5hbWU6ICcnLAogICAgICAgIGNvZGU6ICcnLAogICAgICAgIHRvQ29kZTogJycKICAgICAgfSwgCiAgICB9CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC8qIAogICAg5Yqo5oCB6K6h566X5b6X5YiwRGlhbG9n55qE5qCH6aKYCiAgICAqLwogICAgZGlhbG9nVGl0bGUgKCkgewogICAgICBjb25zdCB7aWQsIGxldmVsfSA9IHRoaXMucGVybWlzc2lvbgogICAgICBpZiAoaWQpIHsKICAgICAgICByZXR1cm4gbGV2ZWw9PT00ID8gJ+S/ruaUueWKn+iDvScgOiAn5L+u5pS56I+c5Y2VJwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBsZXZlbD09PTQgPyAn5re75Yqg5Yqf6IO9JyA6IGDmt7vliqAke2xldmVsPT09Mj8n5LiA57qnJzon5LqM57qnJ33oj5zljZVgCiAgICAgIH0KICAgIH0sCgogICAgLyogCiAgICDmoLnmja7mnYPpmZDnmoTnrYnnuqfmnaXorqHnrpfnoa7lrprmoKHpqozop4TliJkKICAgICovCiAgICBwZXJtaXNzaW9uUnVsZXMgKCkgewogICAgICByZXR1cm4gdGhpcy5wZXJtaXNzaW9uLmxldmVsPT09NCA/IGJ0blJ1bGVzIDogbWVudVJ1bGVzCiAgICB9CiAgfSwKICAKICBtb3VudGVkICgpIHsKICAgIHRoaXMuZmV0Y2hQZXJtaXNzaW9uTGlzdCgpCiAgfSwKCiAgbWV0aG9kczogewoKICAgIC8qIAogICAg5qC55o2u57qn5Yir5b6X5Yiw6KaB5pi+56S655qE5re75YqgZGlhbG9n55qE5qCH6aKYCiAgICAqLwogICAgZ2V0QWRkVGl0bGUgKGxldmVsKSB7CiAgICAgIGlmIChsZXZlbD09PTEgfHwgbGV2ZWw9PT0yKSB7CiAgICAgICAgcmV0dXJuICfmt7vliqDoj5zljZUnCiAgICAgIH0gZWxzZSBpZiAobGV2ZWw9PT0zKXsKICAgICAgICByZXR1cm4gJ+a3u+WKoOWKn+iDvScKICAgICAgfQogICAgfSwgCgogICAgLyogCiAgICDor7fmsYLojrflj5bmnYPpmZDoj5zljZXmlbDmja7liJfooagKICAgICovCiAgICBhc3luYyBmZXRjaFBlcm1pc3Npb25MaXN0KCkgewogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLiRBUEkucGVybWlzc2lvbi5nZXRQZXJtaXNzaW9uTGlzdCgpCiAgICAgIHRoaXMubWVudVBlcm1pc3Npb25MaXN0ID0gcmVzdWx0LmRhdGEuY2hpbGRyZW4KICAgICAgdGhpcy5leHBhbmRLZXlzID0gW3RoaXMubWVudVBlcm1pc3Npb25MaXN0WzBdLmlkXQogICAgfSwKCiAgICAvKiAKICAgIOaYvuekuua3u+WKoOadg+mZkOeahOeVjOmdoijoj5zljZXmiJblip/og70pCiAgICAqLwogICAgdG9BZGRQZXJtaXNzaW9uIChyb3cpIHsKICAgICAgdGhpcy5kaWFsb2dQZXJtaXNzaW9uVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5wZXJtaXNzaW9uLnBpZCA9IHJvdy5pZAogICAgICB0aGlzLnBlcm1pc3Npb24ubGV2ZWwgPSByb3cubGV2ZWwgKyAxCiAgICAgIHRoaXMucGVybWlzc2lvbi50eXBlID0gdGhpcy5wZXJtaXNzaW9uLmxldmVsPT09NCA/IDIgOiAxCiAgICAgIHRoaXMucGVybWlzc2lvbi5wbmFtZSA9IHJvdy5uYW1lIC8vIOeUqOS6juaYvuekuueItuWQjeensCwg5L2G5o+Q5Lqk6K+35rGC5pe25piv5LiN6ZyA6KaB55qECiAgICAgIAogICAgICAvLyDmuIXpmaTmoKHpqowo5b+F6aG75Zyo55WM6Z2i5pu05paw5LmL5ZCOKQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB0aGlzLiRyZWZzLnBlcm1pc3Npb24uY2xlYXJWYWxpZGF0ZSgpKQogICAgfSwKCiAgICAvKiAKICAgIOaYvuekuuiPnOWNlea3u+WKoOaIluabtOaWsOeahGRpYWxvZwogICAgKi8KICAgIHRvVXBkYXRlUGVybWlzc2lvbihyb3cpIHsKICAgICAgdGhpcy5kaWFsb2dQZXJtaXNzaW9uVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5wZXJtaXNzaW9uID0gey4uLnJvd30gIC8vIOS9v+eUqOa1heaLt+i0nQogICAgICB0aGlzLnBlcm1pc3Npb24udHlwZSA9IHRoaXMucGVybWlzc2lvbi5sZXZlbD09PTQgPyAyIDogMQoKICAgICAgLy8g5riF6Zmk5qCh6aqMKOW/hemhu+WcqOeVjOmdouabtOaWsOS5i+WQjikKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gdGhpcy4kcmVmcy5wZXJtaXNzaW9uLmNsZWFyVmFsaWRhdGUoKSkKICAgIH0sCgogICAgLyogCiAgICDliKDpmaTmn5DkuKrmnYPpmZDoioLngrkKICAgICovICAgIAogICAgcmVtb3ZlUGVybWlzc2lvbihwZXJtaXNzaW9uKSB7CiAgICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heWIoOmZpOivpeiusOW9lSwg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7CiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuJEFQSS5wZXJtaXNzaW9uLnJlbW92ZVBlcm1pc3Npb24ocGVybWlzc2lvbi5pZCkKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzdWx0Lm1lc3NhZ2UgfHwgJ+WIoOmZpOaIkOWKnyEnKQogICAgICAgIHRoaXMuZmV0Y2hQZXJtaXNzaW9uTGlzdCgpCiAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgIGlmIChlcnJvcj09PSdjYW5jZWwnKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgdHlwZTogJ2luZm8nLAogICAgICAgICAgICBtZXNzYWdlOiAn5bey5Y+W5raI5Yig6ZmkJwogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAoKICAgIC8qIAogICAg5re75Yqg5oiW5pu05paw5Yqf6IO95p2D6ZmQCiAgICAqLwogICAgYWRkT3JVcGRhdGVQZXJtaXNzaW9uKCkgewogICAgICB0aGlzLiRyZWZzLnBlcm1pc3Npb24udmFsaWRhdGUoYXN5bmMgdmFsaWQgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgY29uc3Qge3BuYW1lLCAuLi5wZXJtfSA9IHRoaXMucGVybWlzc2lvbiAvLyBwbmFtZeS4jemcgOimgeaQuuW4pgogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy4kQVBJLnBlcm1pc3Npb25bcGVybS5pZCA/ICd1cGRhdGVQZXJtaXNzaW9uJyA6ICdhZGRQZXJtaXNzaW9uJ10ocGVybSkKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSB8fCBgJHtwZXJtLmlkID8gJ+S/ruaUuScgOiAn5re75YqgJ33miJDlip8hYCkKICAgICAgICAgIHRoaXMucmVzZXREYXRhKCkKICAgICAgICAgIHRoaXMuZmV0Y2hQZXJtaXNzaW9uTGlzdCgpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKCiAgICAvKiAKICAgIOmHjee9ruaVsOaNrgogICAgKi8KICAgIHJlc2V0RGF0YSgpIHsKICAgICAgdGhpcy5kaWFsb2dQZXJtaXNzaW9uVmlzaWJsZSA9IGZhbHNlCiAgICAgIHRoaXMucGVybWlzc2lvbiA9IHsKICAgICAgICBsZXZlbDogMCwKICAgICAgICBuYW1lOiAnJywKICAgICAgICBjb2RlOiAnJywKICAgICAgICB0b0NvZGU6ICcnCiAgICAgIH0KICAgIH0KICB9Cn0KCg=="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmHA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/acl/permission","sourcesContent":["<template>\n  <div>\n    <!-- \n      code: \"Acl\" // 标识名称\n      deleted: false\n      gmtCreate: \"2020-11-30 16:40:08\"\n      gmtModified: \"2020-11-30 16:40:08\"\n      id: \"1333329957008228353\"\n      level: 2\n      name: \"权限管理\"\n      pid: \"1\" // 所属节点的id\n      select: false\n      status: null\n      toCode: \"\"\n      type: 1  // 1: 路由 2: 按钮\n\n      children: []\n      code: \"btn.Role.assgin\"\n      deleted: false\n      gmtCreate: \"2020-11-30 16:50:13\"\n      gmtModified: \"2020-12-01 08:13:47\"\n      id: \"1333332492158812161\"\n      level: 4\n      name: \"分配权限\"\n      pid: \"1333330152781561858\"\n      select: false\n      status: null\n      toCode: \"RoleAuth\"\n      type: 2\n    -->\n    <el-table\n      border\n      style=\"margin-bottom: 20px;\"\n      :data=\"menuPermissionList\"\n      :expand-row-keys=\"expandKeys\"\n      row-key=\"id\"\n    >\n      <el-table-column\n        prop=\"name\"\n        label=\"名称\"\n      />\n      <el-table-column\n        prop=\"code\"\n        label=\"权限值\"\n      />\n\n      <el-table-column\n        prop=\"toCode\"\n        label=\"跳转权限值\"\n      />\n\n      <el-table-column label=\"操作\">\n        <template slot-scope=\"{row}\">\n          \n          <HintButton\n            :disabled=\"row.level===4\"\n            type=\"primary\"\n            icon=\"el-icon-plus\"\n            size=\"mini\"\n            @click=\"toAddPermission(row)\"\n            :title=\"getAddTitle(row.level)\"\n          />\n\n          <HintButton\n            type=\"primary\"\n            icon=\"el-icon-edit\"\n            size=\"mini\"\n            :disabled=\"row.level===1\"\n            @click=\"toUpdatePermission(row)\"\n            :title=\"row.level===4 ? '修改功能' : '修改菜单'\"\n          />\n\n          <HintButton\n            :disabled=\"row.level===1\"\n            type=\"danger\"\n            icon=\"el-icon-delete\"\n            size=\"mini\"\n            @click=\"removePermission(row)\"\n            title=\"删除\"\n          />\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-dialog \n      :visible.sync=\"dialogPermissionVisible\" \n      :title=\"dialogTitle\" \n      @close=\"resetData\">\n\n      <el-form ref=\"permission\" :model=\"permission\" :rules=\"permissionRules\" label-width=\"120px\">\n        <el-form-item label=\"父级名称\" v-if=\"permission.level>2 && !permission.id\">\n          <el-input :value=\"permission.pname\"  disabled/>\n        </el-form-item>\n        <el-form-item label=\"名称\" prop=\"name\">\n          <el-input v-model=\"permission.name\"/>\n        </el-form-item>\n        \n        <el-form-item label=\"功能权限值\" prop=\"code\">\n          <el-input v-model=\"permission.code\"/>\n        </el-form-item>\n\n        <el-form-item label=\"跳转路由权限值\" prop=\"toCode\" v-if=\"permission.level===4\">\n          <el-input v-model=\"permission.toCode\"/>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"resetData\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"addOrUpdatePermission\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n\n// 菜单权限校验的规则\nconst menuRules = { \n  name: [{required: true, message: '名称必须输入'}],\n  code: [{required: true, message: '权限值必须输入'}],\n}\n\n// 按钮功能权限校验的规则\nconst btnRules = { \n  name: [{required: true, message: '名称必须输入'}],\n  code: [{required: true, trigger: 'blur', message: '功能权限值必须输入'}]\n}\n\nexport default {\n  name: 'PermissionList',\n\n  data() {\n    return {\n      menuPermissionList: [], // 菜单列表\n      expandKeys: [], // 需要自动展开的项\n      dialogPermissionVisible: false, // 是否显示菜单权限的Dialog\n      permission: { // 要操作的菜单权限对象\n        level: 0,\n        name: '',\n        code: '',\n        toCode: ''\n      }, \n    }\n  },\n\n  computed: {\n    /* \n    动态计算得到Dialog的标题\n    */\n    dialogTitle () {\n      const {id, level} = this.permission\n      if (id) {\n        return level===4 ? '修改功能' : '修改菜单'\n      } else {\n        return level===4 ? '添加功能' : `添加${level===2?'一级':'二级'}菜单`\n      }\n    },\n\n    /* \n    根据权限的等级来计算确定校验规则\n    */\n    permissionRules () {\n      return this.permission.level===4 ? btnRules : menuRules\n    }\n  },\n  \n  mounted () {\n    this.fetchPermissionList()\n  },\n\n  methods: {\n\n    /* \n    根据级别得到要显示的添加dialog的标题\n    */\n    getAddTitle (level) {\n      if (level===1 || level===2) {\n        return '添加菜单'\n      } else if (level===3){\n        return '添加功能'\n      }\n    }, \n\n    /* \n    请求获取权限菜单数据列表\n    */\n    async fetchPermissionList() {\n      const result = await this.$API.permission.getPermissionList()\n      this.menuPermissionList = result.data.children\n      this.expandKeys = [this.menuPermissionList[0].id]\n    },\n\n    /* \n    显示添加权限的界面(菜单或功能)\n    */\n    toAddPermission (row) {\n      this.dialogPermissionVisible = true\n      this.permission.pid = row.id\n      this.permission.level = row.level + 1\n      this.permission.type = this.permission.level===4 ? 2 : 1\n      this.permission.pname = row.name // 用于显示父名称, 但提交请求时是不需要的\n      \n      // 清除校验(必须在界面更新之后)\n      this.$nextTick(() => this.$refs.permission.clearValidate())\n    },\n\n    /* \n    显示菜单添加或更新的dialog\n    */\n    toUpdatePermission(row) {\n      this.dialogPermissionVisible = true\n      this.permission = {...row}  // 使用浅拷贝\n      this.permission.type = this.permission.level===4 ? 2 : 1\n\n      // 清除校验(必须在界面更新之后)\n      this.$nextTick(() => this.$refs.permission.clearValidate())\n    },\n\n    /* \n    删除某个权限节点\n    */    \n    removePermission(permission) {\n      this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n        type: 'warning'\n      }).then(async () => {\n        const result = await this.$API.permission.removePermission(permission.id)\n        this.$message.success(result.message || '删除成功!')\n        this.fetchPermissionList()\n      }).catch((error) => {\n        if (error==='cancel') {\n          this.$message({\n            type: 'info',\n            message: '已取消删除'\n          })\n        }\n      })\n    },\n\n    /* \n    添加或更新功能权限\n    */\n    addOrUpdatePermission() {\n      this.$refs.permission.validate(async valid => {\n        if (valid) {\n          const {pname, ...perm} = this.permission // pname不需要携带\n          const result = await this.$API.permission[perm.id ? 'updatePermission' : 'addPermission'](perm)\n          this.$message.success(result.message || `${perm.id ? '修改' : '添加'}成功!`)\n          this.resetData()\n          this.fetchPermissionList()\n        }\n      })\n    },\n\n    /* \n    重置数据\n    */\n    resetData() {\n      this.dialogPermissionVisible = false\n      this.permission = {\n        level: 0,\n        name: '',\n        code: '',\n        toCode: ''\n      }\n    }\n  }\n}\n\n</script>\n"]}]}