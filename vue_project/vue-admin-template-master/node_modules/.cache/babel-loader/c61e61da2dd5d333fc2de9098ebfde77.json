{"remainingRequest":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\src\\views\\acl\\role\\roleAuth.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\src\\views\\acl\\role\\roleAuth.vue","mtime":1638345809000},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\babel.config.js","mtime":1637306514000},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652600907899},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1652600964560},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652600907899},{"path":"C:\\Users\\xiao\\Desktop\\vue_project\\vue-admin-template-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1652600973833}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ3JvbGVBdXRoJywKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIC8vIOeUqOadpeagh+ivhuaYr+WQpuato+WcqOS/neWtmOivt+axguS4reeahOagh+ivhiwg6Ziy5q2i6YeN5aSN5o+Q5LqkCiAgICAgIGFsbFBlcm1pc3Npb25zOiBbXSwKICAgICAgLy8g5omA5pyJCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAnbmFtZScKICAgICAgfQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8qIAogICAg5Yid5aeL5YyWCiAgICAqLwogICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgdmFyIHJvbGVJZCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgdGhpcy5nZXRQZXJtaXNzaW9ucyhyb2xlSWQpOwogICAgfSwKCiAgICAvKiAKICAgIOiOt+WPluaMh+WumuinkuiJsueahOadg+mZkOWIl+ihqAogICAgKi8KICAgIGdldFBlcm1pc3Npb25zOiBmdW5jdGlvbiBnZXRQZXJtaXNzaW9ucyhyb2xlSWQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMuJEFQSS5wZXJtaXNzaW9uLnRvQXNzaWduKHJvbGVJZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgdmFyIGFsbFBlcm1pc3Npb25zID0gcmVzdWx0LmRhdGEuY2hpbGRyZW47CiAgICAgICAgX3RoaXMuYWxsUGVybWlzc2lvbnMgPSBhbGxQZXJtaXNzaW9uczsKCiAgICAgICAgdmFyIGNoZWNrZWRJZHMgPSBfdGhpcy5nZXRDaGVja2VkSWRzKGFsbFBlcm1pc3Npb25zKTsgLy8gY29uc29sZS5sb2coJ2dldFBlcm1pc3Npb25zKCkgY2hlY2tlZElkcycsIGNoZWNrZWRJZHMpCgoKICAgICAgICBfdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWRLZXlzKGNoZWNrZWRJZHMpOwogICAgICB9KTsKICAgIH0sCgogICAgLyogCiAgICDlvpfliLDmiYDmnInpgInkuK3nmoRpZOWIl+ihqAogICAgKi8KICAgIGdldENoZWNrZWRJZHM6IGZ1bmN0aW9uIGdldENoZWNrZWRJZHMoYXV0aHMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgaW5pdEFyciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogW107CiAgICAgIHJldHVybiBhdXRocy5yZWR1Y2UoZnVuY3Rpb24gKHByZSwgaXRlbSkgewogICAgICAgIGlmIChpdGVtLnNlbGVjdCAmJiBpdGVtLmxldmVsID09PSA0KSB7CiAgICAgICAgICBwcmUucHVzaChpdGVtLmlkKTsKICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uY2hpbGRyZW4pIHsKICAgICAgICAgIF90aGlzMi5nZXRDaGVja2VkSWRzKGl0ZW0uY2hpbGRyZW4sIGluaXRBcnIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHByZTsKICAgICAgfSwgaW5pdEFycik7CiAgICB9LAoKICAgIC8qIAogICAg5L+d5a2Y5p2D6ZmQ5YiX6KGoCiAgICAqLwogICAgc2F2ZTogZnVuY3Rpb24gc2F2ZSgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgaWRzID0gdGhpcy4kcmVmcy50cmVlLmdldENoZWNrZWRLZXlzKCkuam9pbigiLCIpOwogICAgICAvKiAKICAgICAgdnVlIGVsZW1lbnRVSSB0cmVl5qCR5b2i5o6n5Lu26I635Y+W54i26IqC54K5SUTnmoTlrp7kvosKICAgICAg5L+u5pS55rqQ56CBOgogICAgICDmg4XlhrUxOiBlbGVtZW50LXVp5rKh5pyJ5a6e546w5oyJ6ZyA5byV5YWl5omT5YyFCiAgICAgICAgbm9kZV9tb2R1bGVzXGVsZW1lbnQtdWlcbGliXGVsZW1lbnQtdWkuY29tbW9uLmpzICAgIDI1Mzgy6KGM5L+u5pS55rqQ56CBICDljrvmjokgJ2luY2x1ZGVIYWxmQ2hlY2tlZCAmJicKICAgICAgICAvLyBpZiAoKGNoaWxkLmNoZWNrZWQgfHwgaW5jbHVkZUhhbGZDaGVja2VkICYmIGNoaWxkLmluZGV0ZXJtaW5hdGUpICYmICghbGVhZk9ubHkgfHwgbGVhZk9ubHkgJiYgY2hpbGQuaXNMZWFmKSkgewogICAgICAgIGlmICgoY2hpbGQuY2hlY2tlZCB8fCBjaGlsZC5pbmRldGVybWluYXRlKSAmJiAoIWxlYWZPbmx5IHx8IGxlYWZPbmx5ICYmIGNoaWxkLmlzTGVhZikpIHsKICAgICAg5oOF5Ya1MjogZWxlbWVudC11aeWunueOsOS6huaMiemcgOW8leWFpeaJk+WMhQogICAgICAgIG5vZGVfbW9kdWxlc1xlbGVtZW50LXVpXGxpYlx0cmVlLmpzICAgIDEwNTHooYzkv67mlLnmupDnoIEgIOWOu+aOiSAnaW5jbHVkZUhhbGZDaGVja2VkICYmJwogICAgICAgIC8vIGlmICgoY2hpbGQuY2hlY2tlZCB8fCBpbmNsdWRlSGFsZkNoZWNrZWQgJiYgY2hpbGQuaW5kZXRlcm1pbmF0ZSkgJiYgKCFsZWFmT25seSB8fCBsZWFmT25seSAmJiBjaGlsZC5pc0xlYWYpKSB7CiAgICAgICAgaWYgKChjaGlsZC5jaGVja2VkIHx8IGNoaWxkLmluZGV0ZXJtaW5hdGUpICYmICghbGVhZk9ubHkgfHwgbGVhZk9ubHkgJiYgY2hpbGQuaXNMZWFmKSkgewogICAgICAqLwoKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy4kQVBJLnBlcm1pc3Npb24uZG9Bc3NpZ24odGhpcy4kcm91dGUucGFyYW1zLmlkLCBpZHMpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIF90aGlzMy5sb2FkaW5nID0gZmFsc2U7CgogICAgICAgIF90aGlzMy4kbWVzc2FnZS5zdWNjZXNzKHJlc3VsdC4kbWVzc2FnZSB8fCAn5YiG6YWN5p2D6ZmQ5oiQ5YqfJyk7IC8vIOW/hemhu+WcqOi3s+i9rOWJjeiOt+WPlijot7PovazlkI7pgJrov4d0aGlz6I635Y+W5LiN5Yiw5q2j56Gu55qE5pWw5o2u5LqGKQoKCiAgICAgICAgdmFyIHJvbGVOYW1lID0gX3RoaXMzLiRyb3V0ZS5xdWVyeS5yb2xlTmFtZTsKICAgICAgICB2YXIgcm9sZXMgPSBfdGhpczMuJHN0b3JlLmdldHRlcnMucm9sZXM7CgogICAgICAgIF90aGlzMy4kcm91dGVyLnJlcGxhY2UoJy9hY2wvcm9sZS9saXN0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coJ3JlcGxhY2Ugb25Db21wbGV0ZScpOyAvLyDot7PovazmiJDlip/lkI4sIOWIpOaWreWmguaenOabtOaWsOeahOaYr+W9k+WJjeeUqOaIt+WvueW6lOinkuiJsueahOadg+mZkCwg6YeN5paw5Yqg6L296aG16Z2i5Lul6I635b6X5pyA5paw55qE5pWw5o2uCgogICAgICAgICAgaWYgKHJvbGVzLmluY2x1ZGVzKHJvbGVOYW1lKSkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KfTs="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;AAkBA;EACAA,gBADA;EAGAC,IAHA,kBAGA;IACA;MACAC,cADA;MACA;MACAC,kBAFA;MAEA;MACAC;QACAC,oBADA;QAEAC;MAFA;IAHA;EAQA,CAZA;EAcAC,OAdA,qBAcA;IACA;EACA,CAhBA;EAkBAC;IACA;AACA;AACA;IACAC,IAJA,kBAIA;MACA;MACA;IACA,CAPA;;IASA;AACA;AACA;IACAC,cAZA,0BAYAC,MAZA,EAYA;MAAA;;MACA;QACA;QACA;;QACA,qDAHA,CAIA;;;QACA;MACA,CANA;IAOA,CApBA;;IAsBA;AACA;AACA;IACAC,aAzBA,yBAyBAC,KAzBA,EAyBA;MAAA;;MAAA;MACA;QACA;UACAC;QACA,CAFA,MAEA;UACA;QACA;;QACA;MACA,CAPA,EAOAC,OAPA;IAQA,CAlCA;;IAoCA;AACA;AACA;IACAC,IAvCA,kBAuCA;MAAA;;MACA;MACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MACA;MACA;QACA;;QACA,qDAFA,CAGA;;;QACA;QACA;;QACA;UACAC,kCADA,CAEA;;UACA;YACAC;UACA;QACA,CANA;MAOA,CAbA;IAcA;EApEA;AAlBA","names":["name","data","loading","allPermissions","defaultProps","children","label","created","methods","init","getPermissions","roleId","getCheckedIds","auths","pre","initArr","save","console","window"],"sourceRoot":"src/views/acl/role","sources":["roleAuth.vue"],"sourcesContent":["<template>\n  <div>\n    <el-input disabled :value=\"$route.query.roleName\"></el-input>\n    <el-tree \n      style=\"margin: 20px 0\"\n      ref=\"tree\"\n      :data=\"allPermissions\" \n      node-key=\"id\"  \n      show-checkbox \n      default-expand-all\n      :props=\"defaultProps\" \n    />\n    <el-button :loading=\"loading\" type=\"primary\" @click=\"save\">保存</el-button>\n    <el-button @click=\"$router.replace({name: 'Role'})\">取消</el-button>\n  </div>\n</template>\n<script>\n\n  export default {\n    name: 'roleAuth',\n\n    data() {\n      return {\n        loading: false, // 用来标识是否正在保存请求中的标识, 防止重复提交\n        allPermissions: [], // 所有\n        defaultProps: {\n          children: 'children',\n          label: 'name'\n        },\n      };\n    },\n\n    created() {\n      this.init()\n    },\n\n    methods: {\n      /* \n      初始化\n      */\n      init() {\n        const roleId = this.$route.params.id\n        this.getPermissions(roleId)\n      },\n\n      /* \n      获取指定角色的权限列表\n      */\n      getPermissions(roleId) {\n        this.$API.permission.toAssign(roleId).then(result => {\n          const allPermissions = result.data.children\n          this.allPermissions = allPermissions\n          const checkedIds = this.getCheckedIds(allPermissions)\n          // console.log('getPermissions() checkedIds', checkedIds)\n          this.$refs.tree.setCheckedKeys(checkedIds)\n        })\n      },\n\n      /* \n      得到所有选中的id列表\n      */\n      getCheckedIds (auths, initArr = []) {\n        return auths.reduce((pre, item) => {\n          if (item.select && item.level===4) {\n            pre.push(item.id)\n          } else if (item.children) {\n            this.getCheckedIds(item.children, initArr)\n          }\n          return pre\n        }, initArr)\n      },\n\n      /* \n      保存权限列表\n      */\n      save() {\n        var ids = this.$refs.tree.getCheckedKeys().join(\",\")\n        /* \n        vue elementUI tree树形控件获取父节点ID的实例\n        修改源码:\n        情况1: element-ui没有实现按需引入打包\n          node_modules\\element-ui\\lib\\element-ui.common.js    25382行修改源码  去掉 'includeHalfChecked &&'\n          // if ((child.checked || includeHalfChecked && child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n          if ((child.checked || child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n        情况2: element-ui实现了按需引入打包\n          node_modules\\element-ui\\lib\\tree.js    1051行修改源码  去掉 'includeHalfChecked &&'\n          // if ((child.checked || includeHalfChecked && child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n          if ((child.checked || child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n        */\n        this.loading = true\n        this.$API.permission.doAssign(this.$route.params.id, ids).then(result => {\n          this.loading = false\n          this.$message.success(result.$message || '分配权限成功')\n          // 必须在跳转前获取(跳转后通过this获取不到正确的数据了)\n          const roleName = this.$route.query.roleName\n          const roles = this.$store.getters.roles\n          this.$router.replace('/acl/role/list', () => {\n            console.log('replace onComplete')\n            // 跳转成功后, 判断如果更新的是当前用户对应角色的权限, 重新加载页面以获得最新的数据\n            if (roles.includes(roleName)) {\n              window.location.reload()\n            }\n          })\n        })\n      }\n    }\n  };\n</script>\n"]}]}